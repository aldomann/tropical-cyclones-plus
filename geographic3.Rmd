---
title: "Análisis de la posición y distancia recorrida de los huracanes"
author: "Alfredo Hernández"
output:
  pdf_document: 
    fig_height: 3.5
    toc: yes
    toc_depth: 2
  html_document:
    df_print: paged
  html_notebook: 
    toc: yes
    toc_depth: 3
---

```{r message=FALSE, warning=FALSE, include=FALSE}
# Libraries ------------------------------------------------
library(measurements) # Convert units

# Source base code -----------------------------------------
source("geographic_base.R")
load("geographic_analysis.RData")
source("../libs/multiplot.R")
```

```{r include=FALSE}
options(dplyr.width = Inf)
```


\newpage

# Análisis de la distancia (III)

```{r include=FALSE}
storms.tracks <- storms.all %>%
	dplyr::filter(n.obs > 1) %>% 
	group_by(storm.id) %>%
	# mutate(distance = distance_haversine(lat, lag(lat), long, lag(long))) %>%
	mutate(distance = distance_slc(lat, lag(lat), long, lag(long))) %>%
	mutate(distance = ifelse(is.na(distance), 0, distance)) %>%
	summarise(first.lat = first(lat), last.lat = last(lat),
						first.long = first(long), last.long = last(long),
						distance = sum(distance))
```

## Comentario sobre el cálculo de la distancia

Usando la fórmula de Haversine (vs la Ley de Cosenos), se obtiene en el peor de los casos una diferencia de 0.37 metros, y de media $10^{-8}$ metros. Pero bueno, en realidad no hay ninguna justificación para usar Haversine en lugar de la Ley de Cosenos (no con la precisión computacional de hoy en día).

## Histogramas de distancia/duración

### Todas las tormentas
```{r}
plot_distance_histogram("NATL") + theme_bw()
plot_distance_histogram("EPAC") + theme_bw()
```

### Developing systems
```{r}
plot_distance_histogram("NATL", 33) + theme_bw()
plot_distance_histogram("EPAC", 33) + theme_bw()
```

\newpage

# Análisis de posición inicial y final (III)

## Mirando las medias

### Todas las tormentas
```{r}
get_location_mean_summary("NATL")
get_location_mean_summary("EPAC")
```

### Developing systems
```{r}
get_location_mean_summary("NATL", 33)
get_location_mean_summary("EPAC", 33)
```

## Mirando las medianas

### Todas las tormentas
```{r}
get_location_median_summary("NATL")
get_location_median_summary("EPAC")
```

### Developing systems
```{r}
get_location_median_summary("NATL", 33)
get_location_median_summary("EPAC", 33)
```


\newpage

# Análisis de posición inicial y final (IV): Boxplots and Wilcoxon Tests

## North Atlantic

### Todas las tormentas (NALT)
```{r}
plot_positions_boxplot("NATL", "first") + theme_bw()
perform_wilcox_test("first.lat", "NATL")
perform_wilcox_test("first.long", "NATL")
```

\newpage

### Developing systems (NALT)
```{r}
plot_positions_boxplot("NATL", "first", 33) + theme_bw()
perform_wilcox_test("first.lat", "NATL", 33)
perform_wilcox_test("first.long", "NATL", 33)
```

\newpage

## East Pacific

### Todas las tormentas (EPAC)
```{r}
plot_positions_boxplot("EPAC", "first") + theme_bw()
perform_wilcox_test("first.lat", "EPAC")
perform_wilcox_test("first.long", "EPAC")
```

\newpage

### Developing systems (EPAC)
```{r}
plot_positions_boxplot("EPAC", "first", 33) + theme_bw()
perform_wilcox_test("first.lat", "EPAC", 33)
perform_wilcox_test("first.long", "EPAC", 33)
```

\newpage

# Análisis de posición (V)


\newpage

## North Atlantic
```{r}
plot_clusters("NATL", "first", n.clust = 2)
	
plot_clusters("NATL", "last", n.clust = 2)
```

\newpage
```{r}
plot_clusters("NATL", "first", 33, n.clust = 2)
plot_clusters("NATL", "last", 33, n.clust = 2)
```

\newpage

## East Pacific
```{r}
plot_clusters("EPAC", "first", n.clust = 3)
plot_clusters("EPAC", "last", n.clust = 3)
```

\newpage
```{r}
plot_clusters("EPAC", "first", 33, n.clust = 3)
plot_clusters("EPAC", "last", 33, n.clust = 3)
```

